
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Security Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Architecture.html" />
    
    
    <link rel="prev" href="Configuration.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Why.html">
            
                <a href="Why.html">
            
                    
                    Why Nussknacker
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="Quickstart.html">
            
                <a href="Quickstart.html">
            
                    
                    Quickstart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="UI.html">
            
                <a href="UI.html">
            
                    
                    UI Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="DesigningProcesses.html">
            
                <a href="DesigningProcesses.html">
            
                    
                    Designing processes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="designingProcesses/BasicNodes.html">
            
                <a href="designingProcesses/BasicNodes.html">
            
                    
                    Basic nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="designingProcesses/Subprocesses.html">
            
                <a href="designingProcesses/Subprocesses.html">
            
                    
                    Subprocesses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="designingProcesses/FlinkCustomTransformers.html">
            
                <a href="designingProcesses/FlinkCustomTransformers.html">
            
                    
                    Flink custom transformers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="Configuration.html">
            
                <a href="Configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.5" data-path="Security.html">
            
                <a href="Security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="Architecture.html">
            
                <a href="Architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Engines.html">
            
                <a href="Engines.html">
            
                    
                    Engines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="API.html">
            
                <a href="API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="Metrics.html">
            
                <a href="Metrics.html">
            
                    
                    Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="Install.html">
            
                <a href="Install.html">
            
                    
                    How to install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Resources.html">
            
                <a href="Resources.html">
            
                    
                    Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="PoweredBy.html">
            
                <a href="PoweredBy.html">
            
                    
                    Powered by Nussknacker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Roadmap.html">
            
                <a href="Roadmap.html">
            
                    
                    Roadmap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="Changelog.html">
            
                <a href="Changelog.html">
            
                    
                    Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="MigrationGuide.html">
            
                <a href="MigrationGuide.html">
            
                    
                    Migration guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="GLOSSARY.html">
            
                <a href="GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Security</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="security">Security</h1>
<p>Nussknacker has pluggable security architecture - by default we support two type of authentication: BasicAuth and OAuth2.
You can either use default authentication provider, based on Basic authentication and static user configuration or integrate 
with other authentication mechanisms such as custom SSO implementation.</p>
<h2 id="users-and-permissions">Users and permissions</h2>
<p>Each user has id and set of permissions for every process category. There are following permissions:</p>
<ul>
<li>Read - user can view processes in category</li>
<li>Write - user can modify/add new processes in category</li>
<li>Deploy - user can deploy or cancel processes in given category</li>
</ul>
<h2 id="global-permissions">Global permissions</h2>
<p>In addition to permission system oriented around processes&apos; categories we provide additional set of permissions.
This feature is designed to control access to components that have no category attached or it doesn&apos;t make sense for them to have one.</p>
<p>Currently supported permissions:</p>
<ul>
<li>AdminTab - shows Admin tab in the UI (right now there are some useful things kept there including search components functionality).</li>
</ul>
<h2 id="basicauth-security-module">BasicAuth security module</h2>
<h4 id="configuration-in-following-format">Configuration in following format:</h4>
<pre><code>authentication: {
  method: &quot;BasicAuth&quot;
  usersFile: &quot;conf/users.conf&quot;
}
</code></pre><h4 id="users-file-in-following-format">Users file in following format:</h4>
<pre><code>users: [
  {
    identity: &quot;user1&quot;
    password: &quot;pass&quot;,
    roles: [&quot;Writer&quot;]
  },
  {
    identity: &quot;user2&quot;
    encryptedPassword: &quot;$2a$12$oA3U7DXkT5eFkyB8GbtKzuVqxUCU0zDmcueBYV218zO/JFQ9/bzY6&quot;
    permissions: [&quot;Deployer&quot;]
  }
]

rules: [
  {
    role: &quot;Reader&quot;
    permissions: [&quot;Read&quot;]
    categories: [&quot;Category1&quot;, &quot;Category2&quot;]
  },
  {
    role: &quot;Writer&quot;
    permissions: [&quot;Read&quot;, &quot;Write&quot;]
    categories: [&quot;Category1&quot;, &quot;Category2&quot;]
  },
  {
    role: &quot;Deployer&quot;
    permissions: [&quot;Read&quot;, &quot;Write&quot;, &quot;Deploy&quot;]
    globalPermissions: [&quot;AdminTab&quot;]
    categories: [&quot;Category1&quot;, &quot;Category2&quot;]
  }
]
</code></pre><h4 id="encrypted-hashes">Encrypted hashes</h4>
<p>Encryption of passwords uses BCrypt algorithm. You can generate sample hash using command:</p>
<pre><code>python -c &apos;import bcrypt; print(bcrypt.hashpw(&quot;password&quot;.encode(&quot;utf8&quot;), bcrypt.gensalt(rounds=12, prefix=&quot;2a&quot;)))&apos;
</code></pre><p>Be aware that usage of BCrypt hashes will cause significant CPU overhead for processing of each http request, because we don&apos;t have sessions and all requests are authenticated.
To avoid this overhead you can configure cashing of hashes using configuration:</p>
<pre><code>authentication: {
  method: &quot;BasicAuth&quot;
  usersFile: &quot;conf/users.conf&quot;
  cachingHashes {
    enabled: true
  }
}
</code></pre><p>This workaround causes that passwords are kept in the memory and it will introduce risk that someone with access to content of heap will see cached passwords.</p>
<h2 id="oauth2-security-module">OAuth2 security module</h2>
<h3 id="generic-configuration">Generic configuration</h3>
<pre><code>authentication: {
  method: ${?AUTHENTICATION_METHOD} (default: &quot;BasicAuth&quot;)
  clientSecret: ${?OAUTH2_CLIENT_SECRET}
  clientId: ${?OAUTH2_CLIENT_ID}
  authorizeUri: ${?OAUTH2_AUTHORIZE_URI}
  redirectUri: ${?OAUTH2_REDIRECT_URI}
  accessTokenUri: ${?OAUTH2_ACCESS_TOKEN_URI}
  profileUri: ${?OAUTH2_PROFILE_URI}
  profileFormat: ${?OAUTH2_PROFILE_FORMAT}
  implicitGrantEnabled: ${?OAUTH2_IMPLICIT_GRANT_ENABLED}
  jwt {
    enabled: ${?OAUTH2_JWT_ENABLED} (default: false)
    publicKey: ${?OAUTH2_JWT_AUTH_SERVER_PUBLIC_KEY}
    publicKeyFile: ${?OAUTH2_JWT_AUTH_SERVER_PUBLIC_KEY_FILE}
    certificate: ${?OAUTH2_JWT_AUTH_SERVER_CERTIFICATE}
    certificateFile: ${?OAUTH2_JWT_AUTH_SERVER_CERTIFICATE_FILE}
    idTokenNonceVerificationRequired: ${?OAUTH2_JWT_ID_TOKEN_NONCE_VERIFICATION_REQUIRED}
  }
  accessTokenParams {
    grant_type: ${?OAUTH2_GRANT_TYPE}
  }
  accessTokenRequestContentType: &quot;application/json&quot; (default)
  authorizeParams {
    response_type: ${?OAUTH2_RESPONSE_TYPE}
    scope: ${?OAUTH2_SCOPE}
    audience: ${?OAUTH2_AUDIENCE}
  }
  headers {
    Accept: ${?AUTHENTICATION_HEADERS_ACCEPT}
  }
  usersFile: ${?AUTHENTICATION_USERS_FILE}
}
</code></pre><p>When <code>method</code> is set to <code>OAuth2</code>, the following fields are mandatory: <code>clientSecret</code>, <code>clientId</code>, <code>authorizeUri</code>, <code>redirectUri</code>, <code>accessTokenUri</code>, <code>profileUri</code>, <code>profileFormat</code>, <code>implicitGrantEnabled</code>, <code>usersFile</code>.</p>
<p>Subconfigs <code>accessTokenParams</code>, <code>accessTokenRequestContentType</code>, <code>authorizeParams</code>, <code>headers</code> are optional and every field from any of the subconfigs is optional and could be provided separately.</p>
<p>By default access token request is sent using <code>application/json</code> content type, to use change it (eg. to <code>application/x-www-form-urlencoded</code>) use <code>accessTokenRequestContentType</code> config.</p>
<p>Subconfig <code>jwt</code> is also optional. However, if it is present and <code>enabled</code> is set to true, <code>idTokenNonceVerificationRequired</code> and one of the <code>publicKey</code>, <code>publicKeyFile</code>, <code>certificate</code>, <code>certificateFile</code> fields have to be provided.</p>
<h4 id="remarks">Remarks:</h4>
<ul>
<li>Setting <code>jwt.idTokenNonceVerificationRequired</code> to <code>true</code> has an effect only if <code>implicitGrantEnabled</code> is also set to <code>true</code>.</li>
<li><p>For security reasons, if implicit flow used, <code>implicitGrantEnabled</code> and <code>jwt.idTokenNonceVerificationRequired</code> should be set to <code>true</code>.
Furthermore <code>authorizeParams.response_type</code> should be set to <code>&quot;access_token id_token&quot;</code> (not only <code>&quot;access_token&quot;</code>).
Then a received <code>access_token</code> format has to be JWT (like <code>id_token</code>).</p>
<p><em>Of course, this does not apply when <code>authorizeParams.response_type</code> is set to <code>code</code> (code flow used).</em></p>
</li>
<li>Provided <code>jwt</code> is enabled, the backend first checks whether a user profile can be obtained from the <code>access_token</code>, secondly it tries to obtain the profile from a request sent to <code>authorizeUri</code>.</li>
</ul>
<h3 id="oauth2-security-module---github-example-with-code-flow">OAuth2 security module - GitHub example with code flow</h3>
<h4 id="configuration-in-following-format">Configuration in following format:</h4>
<pre><code>authentication: {
  method: &quot;OAuth2&quot;
  clientSecret: &quot;&quot;
  clientId: &quot;&quot;
  authorizeUri: &quot;https://github.com/login/oauth/authorize&quot;
  redirectUri: &quot;http://localhost:3000&quot;
  accessTokenUri: &quot;https://github.com/login/oauth/access_token&quot;
  profileUri: &quot;https://api.github.com/user&quot;
  profileFormat: &quot;github&quot;
  implicitGrantEnabled: false
  accessTokenParams {
    grant_type: &quot;authorization_code&quot;
  }
  headers {
    Accept: &quot;application/json&quot;
  }
  authorizeParams {
    response_type: &quot;code&quot;
  }
  usersFile: &quot;./src/test/resources/oauth2-users.conf&quot;
}
</code></pre><h4 id="users-file-in-following-format">Users file in following format:</h4>
<pre><code>users: [ //Special settings by user email
  {
    identity: &quot;some@email.com&quot;
    roles: [&quot;Admin&quot;]
  }
]

rules: [
  {
    role: &quot;Admin&quot;
    isAdmin: true
  },
  {
    role: &quot;User&quot; //this is default role for all users
    permissions: [&quot;Read&quot;, &quot;Write&quot;, &quot;Deploy&quot;]
    categories: [&quot;Defautl&quot;, &quot;FraudDetection&quot;]
  }
]
</code></pre><h3 id="oauth2-security-module---auth0-example-with-implicit-flow">OAuth2 security module - Auth0 example with implicit flow</h3>
<h4 id="auth0-application-configuration">Auth0 application configuration</h4>
<ul>
<li>&quot;Application Type&quot; should be set to &quot;Regular Web Application&quot;</li>
<li>&quot;Use Auth0 instead of the IdP to do Single Sign On&quot; should be enabled.</li>
<li>&quot;Allowed Callback URLs&quot; should contain <code>redirectUri</code>.</li>
<li>&quot;Implicit&quot; should be added to &quot;Grant Types&quot; in &quot;Advanced Settings&quot;.</li>
</ul>
<p>More at <a href="https://auth0.com/docs/get-started/dashboard/application-settings" target="_blank">https://auth0.com/docs/get-started/dashboard/application-settings</a>.</p>
<h4 id="configuration-in-following-format">Configuration in following format:</h4>
<pre><code>authentication: {
  method: &quot;OAuth2&quot;
  clientSecret: &quot;&quot;
  clientId: &quot;&quot;
  authorizeUri: &quot;https://&lt;your-domain&gt;.auth0.com/authorize&quot;
  redirectUri: &quot;http://localhost:3000&quot;
  accessTokenUri: &quot;https://&lt;your-auth0-domain&gt;.auth0.com/oauth/token&quot;
  profileUri: &quot;https://&lt;your-auth0-domain&gt;.auth0.com/userinfo&quot;
  profileFormat: &quot;auth0&quot;
  implicitGrantEnabled: true
  jwt {
    certificateFile: &quot;./etc/cert.pem&quot;
    idTokenNonceVerificationRequired: true
  }
  authorizeParams {
    response_type: &quot;access_token id_token&quot;
    scope: &quot;openid profile email&quot;
    audience: &quot;&lt;your-domain&gt;&quot;
  }
  usersFile: &quot;./src/test/resources/oauth2-users.conf&quot;
}
</code></pre><h5 id="users-file-in-the-same-format-as-in-github-example"><em>Users file in the same format as in GitHub example.</em></h5>
<h4 id="implementation-own-oauth2servicefactory">Implementation own OAuth2ServiceFactory</h4>
<p>OAuth2 backend allows to exchange engine to fetching / parsing data from your OAuth2 Authentication Server and Profile Resource. 
By default we support Github data format. To do this, simply replace the OAuth2ServiceFactory by your own implementation. 
After that you have to register your implementation using Java&apos;s ServiceLoader mechanism by prepare <code>META-INFO/service</code> 
resource for <code>pl.touk.nussknacker.ui.security.oauth2.OAuth2ServiceFactory</code>. You can find an example at tests in 
<code>ExampleOAuth2ServiceFactory</code> file.</p>
<p>You can store passwords as plaintext or (preferably) encrypted using bcrypt. To compute encrypted password you can use following python script:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> bcrypt
print(bcrypt.hashpw(<span class="hljs-string">&quot;password_to_encode&quot;</span>.encode(<span class="hljs-string">&quot;utf8&quot;</span>), bcrypt.gensalt(rounds = <span class="hljs-number">12</span>, prefix = <span class="hljs-string">&quot;2a&quot;</span>)))
</code></pre>
<h2 id="implementing-own-security-provider">Implementing own security provider</h2>
<p>In order to implement authentication provider you have to implement trait: </p>
<pre><code class="lang-java">trait AuthenticatorFactory {
  <span class="hljs-function">def <span class="hljs-title">createAuthenticator</span><span class="hljs-params">(config: Config, classLoader: ClassLoader)</span>: AuthenticationDirective[LoggedUser]
}
</span></code></pre>
<p>It is based on <code>AuthenticationDirective</code> of Akka Http. Implementation must be put on Nussknacker classpath (Note: <strong>not</strong> in jar with <a href="GLOSSARY.html#model" class="glossary-term" title="Model describes your processes, includes data structures, and nodes definitions.  ">model</a>)
You must also register your implementation using Java&apos;s ServiceLoader mechanism - that is, you have to provide
file <code>META-INF/services/pl.touk.nussknacker.ui.security.api.AuthenticatorFactory</code> containing fully qualified name of implementation of <code>AuthenticatorFactory</code>.
Please note that there can be <strong>only</strong> one implementation on the classpath. </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Configuration.html" class="navigation navigation-prev " aria-label="Previous page: Configuration">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Architecture.html" class="navigation navigation-next " aria-label="Next page: Architecture">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Security","level":"2.5","depth":1,"next":{"title":"Architecture","level":"3.1","depth":1,"path":"Architecture.md","ref":"Architecture.md","articles":[]},"previous":{"title":"Configuration","level":"2.4","depth":1,"path":"Configuration.md","ref":"Configuration.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"nussknackerVersion":"0.0.11","flinkMajorVersion":"1.9"},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Security.md","mtime":"2020-11-17T10:04:12.684Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-11-17T10:05:09.584Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

